---
{{ ansible_managed | comment }}

apiVersion: helm.cattle.io/v1
kind: HelmChartConfig
metadata:
  name: traefik
  namespace: kube-system
spec:
    # it seems best to keep these helm values together in a single crd
    # https://github.com/traefik/traefik-helm-chart/blob/v25.0.0/traefik/VALUES.md
  valuesContent: |-
    # This helm chart is locked at v2 of Traefik. K3s is managing the compatible Traefik versions.
    # image:
    #   repository: "traefik"
    #   tag: "3.1"
    logs:
      general:
        level: INFO
    envFrom:
      - secretRef:
          name: dns-aws-credentials # dns-secrets.yaml
      - configMapRef:
          name: aws-config #traefik-env.yaml
    certResolvers:
      aws-dns: # acme is added automatically
        email: {{ aws_dns_email }}
        storage: /data/acme.json # must match persistence
        #caServer: https://acme-staging-v02.api.letsencrypt.org/directory
        caServer: https://acme-v02.api.letsencrypt.org/directory
        dnsChallenge:
          provider: route53
    persistence:
      enabled: true
      # defaults to creating a /data directory
