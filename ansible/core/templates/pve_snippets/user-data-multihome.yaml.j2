#cloud-config
# users: [] # disable creation of default users
users:
  - default
  # - name: foobar
  #   lock_passwd: false
  #   plain_text_passwd: password
  #   sudo: ["ALL=(ALL) NOPASSWD:ALL"]
  # https://cloudinit.readthedocs.io/en/latest/reference/examples.html#configure-instance-to-be-managed-by-ansible
  - name: ansible
    gecos: Ansible User
    groups: users,admin,wheel
    sudo: ["ALL=(ALL) NOPASSWD:ALL"]
    shell: /bin/bash
    lock_passwd: true
    ssh_authorized_keys:
      - ${ansible_ssh_public_key}
locale: en_US
keyboard:
  layout: us
package_update: false
package_upgrade: true
packages:
  - qemu-guest-agent
  - sudo
  - cloud-guest-utils
  - console-setup # allow updating keyboard and locale, but will require a restart to get past any ci failures
ssh_quiet_keygen: true
disable_root: false # create root user
allow_public_ssh_keys: true
# root ssh keys, needed for packer build
# they are removed from the VM before completion
# ssh_authorized-keys:
#   - ${ssh_public_key}
timezone: UTC
disable_ec2_metadata: true
runcmd:
  - systemctl enable qemu-guest-agent
  - systemctl start qemu-guest-agent
  - echo "done" > /tmp/cloud-config.done
