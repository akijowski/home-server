---
- name: Pull Docker Image ({{ arm_container_tag }})
  community.docker.docker_image:
    name: "{{ arm_container_image }}:{{ arm_container_tag }}"
    source: pull

# - name: Configure mountpoints
- name: Create docker start command
  ansible.builtin.template:
    backup: false
    dest: "{{ arm_user_home }}/{{ arm_docker_start_script }}"
    group: "{{ arm_group_name }}"
    owner: "{{ arm_user_name }}"
    mode: '0755'
    src: templates/docker_start.sh.j2

- name: Create docker stop command
  ansible.builtin.template:
    backup: false
    dest: "{{ arm_user_home }}/{{ arm_docker_stop_script }}"
    group: "{{ arm_group_name }}"
    owner: "{{ arm_user_name }}"
    mode: '0755'
    src: templates/docker_stop.sh.j2

# TODO:
# https://blog.container-solutions.com/running-docker-containers-with-systemd
# https://github.com/ibuildthecloud/systemd-docker (check the issues, not maintained)
# - name: Copy the arm systemd service file
#   ansible.builtin.template:
#     dest: /etc/systemd/system/arm.service
#     src: arm.service.j2
#     owner: root
#     group: root
#     mode: '0644'
#   notify: restart arm

# TODO:
# Switch to Podman, native support for systemd
