#!/usr/bin/env bash

set -eou pipefail

# Find files with name in the ~/.kube directory. Print out the path with a ':' then remove the trailing ':'
CONFIGS="$HOME/.kube/config:$(find ~/.kube -type f -name '*_cluster*.yaml' -printf "%p:" | sed 's/:$//')"

function merge() {
    echo "Using $CONFIGS"
    KUBECONFIG="$CONFIGS" kubectl config view --flatten --merge > "$HOME/.kube/config"
}

function main() {
    merge
}

main "$@"
