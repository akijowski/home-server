# Tdarr: Distributed Encoding

Distributed, automated, plug-in based transcoding system for media.

## Project

- [Site](https://home.tdarr.io)
- [Docs](https://docs.tdarr.io/docs/welcome/what)
- [Github Repo](https://github.com/HaveAGitGat/Tdarr)

## Hot it is used

Tdarr is set up to manage the media transcoding from files generated by the Automatic-Ripping-Machine project.
The primary Tdarr server is run as workload on the K3s cluster.
Additional Tdarr nodes are run as additional kubernetes workloads or Proxmox LXC instances.

### Kubernetes

The [storage](./storage.yaml) components for Tdarr is incredibly important for Tdarr to function properly[^1].
There is a "debug" deployment created and the NFS PersistentVolumes were created by following Kubernetes example manifests[^2].
Each PV is manually created instead of through a Storage Provider Class[^3] in order to maintain control over the file system lifecycle (let's not delete our data plz).
Other projects may diverge from this depending on requirements.

### TrueNAS / NFS Shares

As most of the communication between Tdarr nodes seems to be via various file paths, it is important to have the necessary NFS shares available for the workloads.
This means TrueNAS (or whatever is the NFS) must share the following directories:

- Raw media to transcode (`/media` mounted from service like Automatic-Ripping-Machine)
- Transcode cache :important: (`/temp` as `<nfs mount>/tdarr/cache`)
- Transcode output such as Plex (`/opt/plex/media` as `<nfs mount>/plex/media`)
- Server plugins, etc (`/app/server` as `<nfs mount>/tdarr/server`)
- Server config (`/app/configs` as `<nfs mount>/tdarr/configs`)

## Links

- https://tdarr.k8s.home.kijowski.io

## TODO

- [ ] Learn how to use Tdarr and what set of plugins work best for my needs
- [ ] Figure out how to regularly backup this config
- [ ] Expand nodes and figure out how to organize the service config directories on the NAS

[^1]: [how to run distributed Tdarr and share directories](https://docs.tdarr.io/docs/installation/windows-linux-macos#path-translators)
[^2]: [example nfs k8s pv project](https://github.com/kubernetes/examples/tree/master/staging/volumes/nfs)
[^3]: [nfs k8s storage provisioner](https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner)
